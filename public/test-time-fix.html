<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¶é—´ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .time-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            border-left: 4px solid #007bff;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 4px;
        }
        .before {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .after {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ• æ—¶é—´ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        <p>æµ‹è¯•å‰ç«¯æ—¶é—´æ˜¾ç¤ºä¿®å¤æ•ˆæœ</p>
        
        <div class="time-display">
            <strong>å½“å‰ç³»ç»Ÿæ—¶é—´:</strong><br>
            åŸå§‹æ—¶é—´: <span id="rawTime"></span><br>
            UTCæ—¶é—´: <span id="utcTime"></span><br>
            åŒ—äº¬æ—¶é—´: <span id="beijingTime"></span><br>
            æ—¶åŒºåç§»: <span id="timezoneOffset"></span> åˆ†é’Ÿ
        </div>

        <div class="comparison">
            <div class="before">
                <h3>âŒ ä¿®å¤å‰ (æ—§æ–¹æ³•)</h3>
                <div id="oldMethod"></div>
            </div>
            <div class="after">
                <h3>âœ… ä¿®å¤å (æ–°æ–¹æ³•)</h3>
                <div id="newMethod"></div>
            </div>
        </div>

        <div class="container">
            <h3>ğŸ§ª æµ‹è¯•ç”¨ä¾‹</h3>
            <button onclick="testTimeFormatting()">æµ‹è¯•æ—¶é—´æ ¼å¼åŒ–</button>
            <button onclick="testBackendTimestamps()">æµ‹è¯•åç«¯æ—¶é—´æˆ³</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
            
            <div id="testResults" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿåç«¯è¿”å›çš„UTCæ—¶é—´æˆ³
        const backendTimestamps = [
            '2025-01-20T09:09:00.000Z',  // UTCæ—¶é—´ 09:09
            '2025-01-20T17:09:00.000Z',  // UTCæ—¶é—´ 17:09
            new Date().toISOString()     // å½“å‰UTCæ—¶é—´
        ];

        // æ—§çš„æ—¶é—´æ ¼å¼åŒ–æ–¹æ³• (ä¿®å¤å‰)
        function oldFormatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        // æ–°çš„æ—¶é—´æ ¼å¼åŒ–æ–¹æ³• (ä¿®å¤å)
        function newFormatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false,
                timeZone: 'Asia/Shanghai'
            });
        }

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('rawTime').textContent = now.toString();
            document.getElementById('utcTime').textContent = now.toISOString();
            document.getElementById('beijingTime').textContent = now.toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
            document.getElementById('timezoneOffset').textContent = now.getTimezoneOffset();
        }

        function testTimeFormatting() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h4>æ—¶é—´æ ¼å¼åŒ–æµ‹è¯•ç»“æœ:</h4>';
            
            backendTimestamps.forEach((timestamp, index) => {
                const oldResult = oldFormatTime(timestamp);
                const newResult = newFormatTime(timestamp);
                const isCorrect = newResult === '17:09' || newResult === '09:09'; // é¢„æœŸç»“æœ
                
                html += `
                    <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <strong>æµ‹è¯• ${index + 1}:</strong> ${timestamp}<br>
                        <span class="error">æ—§æ–¹æ³•: ${oldResult}</span><br>
                        <span class="success">æ–°æ–¹æ³•: ${newResult}</span><br>
                        <span style="color: ${isCorrect ? '#28a745' : '#dc3545'}">
                            ${isCorrect ? 'âœ… æ­£ç¡®' : 'âŒ éœ€è¦è°ƒæ•´'}
                        </span>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function testBackendTimestamps() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h4>åç«¯æ—¶é—´æˆ³æµ‹è¯•ç»“æœ:</h4>';
            
            // æ¨¡æ‹Ÿä¸åŒçš„åç«¯æ—¶é—´æ ¼å¼
            const testCases = [
                { name: 'UTCæ—¶é—´ 09:09', time: '2025-01-20T09:09:00.000Z', expected: '17:09' },
                { name: 'UTCæ—¶é—´ 17:09', time: '2025-01-20T17:09:00.000Z', expected: '01:09' },
                { name: 'å½“å‰æ—¶é—´', time: new Date().toISOString(), expected: 'å½“å‰æ—¶é—´' }
            ];
            
            testCases.forEach(test => {
                const oldResult = oldFormatTime(test.time);
                const newResult = newFormatTime(test.time);
                const date = new Date(test.time);
                const beijingTime = date.toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                
                html += `
                    <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <strong>${test.name}:</strong><br>
                        åŸå§‹æ—¶é—´æˆ³: ${test.time}<br>
                        åŒ—äº¬æ—¶é—´: ${beijingTime}<br>
                        <span class="error">æ—§æ–¹æ³•: ${oldResult}</span><br>
                        <span class="success">æ–°æ–¹æ³•: ${newResult}</span><br>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        // æ›´æ–°å¯¹æ¯”æ˜¾ç¤º
        function updateComparison() {
            const testTimestamp = '2025-01-20T09:09:00.000Z'; // UTC 09:09ï¼Œåº”è¯¥æ˜¯åŒ—äº¬æ—¶é—´ 17:09
            
            document.getElementById('oldMethod').innerHTML = `
                <strong>è¾“å…¥:</strong> ${testTimestamp}<br>
                <strong>è¾“å‡º:</strong> ${oldFormatTime(testTimestamp)}<br>
                <strong>é—®é¢˜:</strong> æ²¡æœ‰æ—¶åŒºè½¬æ¢
            `;
            
            document.getElementById('newMethod').innerHTML = `
                <strong>è¾“å…¥:</strong> ${testTimestamp}<br>
                <strong>è¾“å‡º:</strong> ${newFormatTime(testTimestamp)}<br>
                <strong>ä¿®å¤:</strong> æ˜ç¡®æŒ‡å®šåŒ—äº¬æ—¶é—´
            `;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            updateCurrentTime();
            updateComparison();
            setInterval(updateCurrentTime, 1000);
        };
    </script>
</body>
</html>
