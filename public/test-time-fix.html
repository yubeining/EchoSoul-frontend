<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间修复验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .time-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            border-left: 4px solid #007bff;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 4px;
        }
        .before {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .after {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🕐 时间修复验证测试</h1>
        <p>测试前端时间显示修复效果</p>
        
        <div class="time-display">
            <strong>当前系统时间:</strong><br>
            原始时间: <span id="rawTime"></span><br>
            UTC时间: <span id="utcTime"></span><br>
            北京时间: <span id="beijingTime"></span><br>
            时区偏移: <span id="timezoneOffset"></span> 分钟
        </div>

        <div class="comparison">
            <div class="before">
                <h3>❌ 修复前 (旧方法)</h3>
                <div id="oldMethod"></div>
            </div>
            <div class="after">
                <h3>✅ 修复后 (新方法)</h3>
                <div id="newMethod"></div>
            </div>
        </div>

        <div class="container">
            <h3>🧪 测试用例</h3>
            <button onclick="testTimeFormatting()">测试时间格式化</button>
            <button onclick="testBackendTimestamps()">测试后端时间戳</button>
            <button onclick="clearResults()">清空结果</button>
            
            <div id="testResults" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        // 模拟后端返回的UTC时间戳
        const backendTimestamps = [
            '2025-01-20T09:09:00.000Z',  // UTC时间 09:09
            '2025-01-20T17:09:00.000Z',  // UTC时间 17:09
            new Date().toISOString()     // 当前UTC时间
        ];

        // 旧的时间格式化方法 (修复前)
        function oldFormatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        // 新的时间格式化方法 (修复后)
        function newFormatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false,
                timeZone: 'Asia/Shanghai'
            });
        }

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('rawTime').textContent = now.toString();
            document.getElementById('utcTime').textContent = now.toISOString();
            document.getElementById('beijingTime').textContent = now.toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
            document.getElementById('timezoneOffset').textContent = now.getTimezoneOffset();
        }

        function testTimeFormatting() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h4>时间格式化测试结果:</h4>';
            
            backendTimestamps.forEach((timestamp, index) => {
                const oldResult = oldFormatTime(timestamp);
                const newResult = newFormatTime(timestamp);
                const isCorrect = newResult === '17:09' || newResult === '09:09'; // 预期结果
                
                html += `
                    <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <strong>测试 ${index + 1}:</strong> ${timestamp}<br>
                        <span class="error">旧方法: ${oldResult}</span><br>
                        <span class="success">新方法: ${newResult}</span><br>
                        <span style="color: ${isCorrect ? '#28a745' : '#dc3545'}">
                            ${isCorrect ? '✅ 正确' : '❌ 需要调整'}
                        </span>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function testBackendTimestamps() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h4>后端时间戳测试结果:</h4>';
            
            // 模拟不同的后端时间格式
            const testCases = [
                { name: 'UTC时间 09:09', time: '2025-01-20T09:09:00.000Z', expected: '17:09' },
                { name: 'UTC时间 17:09', time: '2025-01-20T17:09:00.000Z', expected: '01:09' },
                { name: '当前时间', time: new Date().toISOString(), expected: '当前时间' }
            ];
            
            testCases.forEach(test => {
                const oldResult = oldFormatTime(test.time);
                const newResult = newFormatTime(test.time);
                const date = new Date(test.time);
                const beijingTime = date.toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                
                html += `
                    <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <strong>${test.name}:</strong><br>
                        原始时间戳: ${test.time}<br>
                        北京时间: ${beijingTime}<br>
                        <span class="error">旧方法: ${oldResult}</span><br>
                        <span class="success">新方法: ${newResult}</span><br>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        // 更新对比显示
        function updateComparison() {
            const testTimestamp = '2025-01-20T09:09:00.000Z'; // UTC 09:09，应该是北京时间 17:09
            
            document.getElementById('oldMethod').innerHTML = `
                <strong>输入:</strong> ${testTimestamp}<br>
                <strong>输出:</strong> ${oldFormatTime(testTimestamp)}<br>
                <strong>问题:</strong> 没有时区转换
            `;
            
            document.getElementById('newMethod').innerHTML = `
                <strong>输入:</strong> ${testTimestamp}<br>
                <strong>输出:</strong> ${newFormatTime(testTimestamp)}<br>
                <strong>修复:</strong> 明确指定北京时间
            `;
        }

        // 页面加载时初始化
        window.onload = function() {
            updateCurrentTime();
            updateComparison();
            setInterval(updateCurrentTime, 1000);
        };
    </script>
</body>
</html>
